# 🧭 Geth Private Network Setup (Local & Playground OSS)

This document provides step-by-step instructions for installing and running a **Geth private Ethereum network**, both **locally** (using Kind and Kurtosis) and on **mqube-playground.com** (the test OSS cluster).

---

## 🚀 Overview

The private Ethereum network runs using the [ethpandaops/ethereum-helm-charts](https://github.com/ethpandaops/ethereum-helm-charts) Helm chart.  
Installation is performed via:

```bash
helm upgrade --install ...
```

Helm values are overridden through custom `values.yaml` files to allow easy deployment in environments such as **staging**, or **production** using **Jenkins X (JX)** and `helmfiles.yaml`.

You’ll need two main components:

1. **Helm values** (`values.yaml`) — defines configuration for Helm installations (used in JX via `helmfiles.yaml`).
2. **Network setup files** — includes `genesis.json`, `config.yaml`, `genesis.ssz`, and related files defining the private chain configuration.

---

## ⚙️ Network Configuration Files

The default chart is configured for a global **Ethereum testnet**, but we’re running a **private network** instead.

Custom configuration files are stored in this repository under:

```
/network-configs
```

These override the defaults from the Helm chart.

---

## 🧰 Generating the Private Network Configuration with Kurtosis

We use [Kurtosis](https://github.com/kurtosis-tech/kurtosis) — a development orchestration tool similar to Docker Compose or Helm, but designed for more complex stack setups (especially for blockchain testnets).

Kurtosis simplifies generating the configuration files needed for a local Ethereum network.

### 🧑‍💻 Install Kurtosis

```bash
brew install kurtosis-tech/tap/kurtosis-cli
```

### 🧱 Set up a Kind Cluster

Kurtosis runs best with Kind (Kubernetes-in-Docker) on macOS:

```bash
brew install kind
kind create cluster --name kurtosis
```

Then connect Kurtosis to that cluster:

```bash
kurtosis cluster set kind-kurtosis
kurtosis cluster ls
kurtosis engine status
```

Start or restart the Kurtosis engine:

```bash
kurtosis engine start
# or
kurtosis engine restart
```

You can monitor logs using:

```bash
kurtosis gateway
```

### 🧹 Clean Up Old Enclaves

If you previously set up a testnet, clean it up first:

```bash
kurtosis enclave rm -f my-testnet
kurtosis clean -a
```

### 🌐 Launch a Private Ethereum Network

Run the official `ethpandaops` Ethereum package inside a new enclave:

```bash
kurtosis run --enclave my-testnet github.com/ethpandaops/ethereum-package
```

### 📁 Download Generated Config Files

After setup, download the configuration files used/generated by Kurtosis:

```bash
kurtosis files download my-testnet el_cl_genesis_data ./out/el_cl_genesis_data
```

These are the files uploaded to this repo under `/network-configs`, replacing the testnet files from the Helm chart.

---

## 🏗️ Deploying the Private Network (Execution, Beacon, Validator)

### Geth (Execution Node)

To install the **Geth execution node** locally or on the Playground OSS cluster:

```bash
helm upgrade --install geth-devnet .   -f helm-configs/geth-execution.yaml
```

> 💡 Use the Helm chart directly from `ethpandaops/ethereum-helm-charts`, or reference it from this repo.  
> On JX (e.g., staging), prefer using `helm repo add` in your Helmfile setup.

### Beacon Node

```bash
helm upgrade --install beacon-devnet .   -f helm-configs/beacon.yaml
```

### Validator Node

```bash
helm upgrade --install validator-devnet .   -f helm-configs/validator.yaml
```

These three components—**Geth**, **Beacon**, and **Validator**—together form a complete **Proof-of-Stake (PoS)** Ethereum private network.

For more details on Prysm (Beacon & Validator):

📘 [Prysm Documentation](https://prysm.offchainlabs.com/docs/)  
💻 [Geth (go-ethereum) Repository](https://github.com/ethereum/go-ethereum)

---

## 🔍 Blockscout Setup

[Blockscout](https://github.com/blockscout/blockscout) provides an explorer interface for viewing your private network.

We deploy it on the **playground OSS cluster**.

### 1. Install PostgreSQL

```bash
helm upgrade --install blockscout-db oci://registry-1.docker.io/bitnamicharts/postgresql   -n default -f helm-configs/block-postgress.yaml
```

> ⚠️ When uninstalling, remember to delete the PVC to ensure a clean database reset:

```bash
kubectl delete pvc data-blockscout-db-postgresql-0
```

This ensures that your next deployment starts with a fresh, empty database.

---

### 2. Create the Stats Database

Blockscout’s **Stats service** (written in Rust) requires a manual DB creation step because it doesn’t support `sslmode=disable`.

Run the helper script in this repo:

```bash
./scripts/createStatsDB.sh
```

---

### 3. Create the PostgreSQL Secret

This secret stores database credentials for the Blockscout Helm chart:

```bash
./scripts/postgress-secret-script.sh
```

---

### 4. Install Blockscout

```bash
helm upgrade --install blockscout blockscout/blockscout-stack   -n default -f helm-configs/block-scout.yaml
```

> 🛈 You may see warnings about environment variables being overridden — this is expected due to how the chart merges environment configs.

---

### 🌍 Access the Explorer

Once deployed, you can view your private network in Blockscout:

👉 [https://mqube-blockscout-frontend.mqube-playground.com/](https://mqube-blockscout-frontend.mqube-playground.com/)

---

## ✅ Summary

| Component | Purpose | Helm Config |
|------------|----------|-------------|
| **Geth** | Execution Layer | `helm-configs/geth-execution.yaml` |
| **Beacon** | Consensus Layer (Prysm) | `helm-configs/beacon.yaml` |
| **Validator** | Proof-of-Stake Validator | `helm-configs/validator.yaml` |
| **Blockscout** | Blockchain Explorer | `helm-configs/block-scout.yaml` |
| **PostgreSQL** | Blockscout DB | `helm-configs/block-postgress.yaml` |

---

## 🧩 Notes

- Use **Kind** for local testing and **mqube-playground.com** for shared OSS deployments.
- Always clean up PVCs during reinstallation to avoid stale data.
- Kurtosis is optional but extremely useful for generating consistent Ethereum config files.
- Ensure all three core components (Geth, Beacon, Validator) are running before deploying Blockscout.

